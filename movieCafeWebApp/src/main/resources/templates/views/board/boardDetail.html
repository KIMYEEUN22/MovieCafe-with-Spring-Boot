<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/defaultLayout}">

<th:block layout:fragment="script">
        <script th:src="@{/js/board/recomBoard.js}"></script>
</th:block>

<head>
<script>
   
$(document).ready(function(){

$("#addComBtn").click(function(){
 $.ajax({
    url : "/createcom",
    type : 'POST',
    contentType : 'application/json;charset=utf-8',
    dataType : 'json',
    data : JSON.stringify({
       "boardNo" : $('#boardNo').val(),
       "comContent" : $('#comContent').val()
    }),
    success : function(data){
       const comment = data.results;
       $('#origincom').hide();
       $('#comAction').text(data.comCnt);
      
       $("#listComment").html("");
       let str = '<thead><tr><td>작성자</td><td>날짜</td></tr><thead>'
       for(let i = 0 ; i < comment.length ; i++){
          str +='<tbody id = "' + comment[i].comNo + '">' +
                   '<tr>' + 
                    '<td>' + comment[i].userNick + '</td>' + 
                    '<td>' + comment[i].comWdate + '</td>' + 
                 '</tr>' +       
                 '<tr>' + 
                    '<td colspan="2" class="comContent">' + comment[i].comContent + '</td>' + 
                 '</tr>' +
                 '<tr>' +   
                    '<td colspan="2">' + 
                       '<button class="modifyComReqBtn" type="button">수정</button>&nbsp;' +       
                       '<button id="removeBtn">삭제</button>' +   
                    '</td>'   +    
                 '</tr></tbody>'
       }
          $("#listComment").html(str);
 
    },
    error : function(err){
       console.log(err);
    }


 });
});


$(document).on("click", "#removeBtn", function(){
const comNo = $(this).parents('tbody').attr('id');
const boardNo = $('#boardNo').val();

$.ajax({
 url : '/remove/'+ comNo + "/" + boardNo,
 type : 'POST',
 dataType : 'json',
 success : function(data){
       const comment = data.results;
       $('#origincom').hide();
       $('#comAction').text(data.comCnt);
      
       $("#listComment").html("");
       let str = '<thead><tr><td>작성자</td><td>날짜</td></tr><thead>'
       for(let i = 0 ; i < comment.length ; i++){
          str +='<tbody id = "' + comment[i].comNo + '">' +
                   '<tr>' + 
                    '<td>' + comment[i].userNick + '</td>' + 
                    '<td>' + comment[i].comWdate + '</td>' + 
                 '</tr>' +       
                 '<tr>' + 
                    '<td colspan="2" class="comContent">' + comment[i].comContent + '</td>' + 
                 '</tr>' +
                 '<tr>' +   
                    '<td colspan="2">' + 
                       '<button class="modifyComReqBtn" type="button">수정</button>&nbsp;' +       
                       '<button id="removeBtn">삭제</button>' +   
                    '</td>'   +    
                 '</tr></tbody>'
       }
          $("#listComment").html(str);

    },
    error : function(err){
       console.log(err);
    }

 });
});


//댓글 수정용 함수
$('#listComment').on('click', '.modifyComReqBtn', function() {                
const comNo = $(this).parents('tbody').attr('id');
$('#modifyComment').insertAfter('#' + comNo);                   
const comContent = $(this).parents('tbody').find('.comContent').text();                
$('#modifyComContent').val(comContent);
$('#comNo').val(comNo);
$('#modifyComment').show();
$('#' + comNo).hide();                          
});
//댓글 취소
$('#cancel').on('click', function() {
const comNo = $('#comNo').val();
$('#' + comNo).show();    
$('#modifyComment').hide();
$('#modifyComment').insertAfter('#addComment');
});


$("#modifyComBtn").click(function(){
$.ajax({   
url : '/modifycom' ,
type : 'POST',
contentType : 'application/json;charset=utf-8',
data : JSON.stringify({
 "boardNo" : $('#boardNo').val(),
 "comNo" : $('#comNo').val(),
 "comContent" : $('#modifyComContent').val(),
 "userId" : $('#userId').val()
}),
success : function(data){
 const comment = data.results;
 $("#listComment").html("");
 let str = '<thead><tr><td>작성자</td><td>날짜</td></tr><thead>'
 for(let i = 0 ; i < comment.length ; i++){
    str += '<tbody id = "' + comment[i].comNo + '">' +
          '<tr>' + 
              '<td>' + comment[i].userNick + '</td>' + 
              '<td>' + comment[i].comWdate + '</td>' + 
           '</tr>' +    
           '<tr>' + 
              '<td colspan="2" class="comContent">' + comment[i].comContent + '</td>' + 
           '</tr>' +
           '<tr>' +   
              '<td colspan="2">' + 
                 '<button class="modifyComReqBtn" type="button">수정</button>&nbsp;' +       
                 '<button id="removeBtn">삭제</button>' +
              '</td>'   +             
           '</tr>'+
           '</tbody>'
 }
    $("#listComment").html(str);

},
error : function(err){
 console.log(err);
}

});
});
});
</script>
</head>
<section layout:fragment="content">

	<div class="container">
	<form th:action="@{/deleteBoard/{boardNo}(boardNo=${board.boardNo})}"
		method="post">
		
		
		<input type="hidden" name="cateNo" th:value="${board.cateNo}">
		
		<input type="hidden" id="writer" name="userId" th:value="${board.userId}">
		
		<input type="hidden" id="boardNo" name="boardNo" th:value="${board.boardNo}">
		
		<table class="table">
			<tr>
				<td colspan="5" th:text="${board.boardTitle}"></td>
			</tr>
			<tr>
				<td th:text="${board.userNick}"></td>
				<td th:text="${board.boardWdate}"></td>
				<td th:text="${board.boardCount}"></td>
				
				<td>추천</td>
				<td id="originRecom" th:text="${board.recomCount}"><td><div id="recomAction"></div></td></td>
				<td>댓글</td>
				<td  id="origincom" th:text="${board.commentCount}"><td><div id="comAction"></div></td></td>
			</tr>
			<tr>
				<td colspan="5" th:text="${board.boardContent}"></td>
			</tr>
		</table>
		
		<button type="submit" class="btn btn-danger waves-effect waves-light">삭제</button>
		<a class="btn btn-default waves-effect waves-light" th:href="@{/modifyform/{boardNo}(boardNo=${boardNo})}">수정</a>
		
</form>	
	
<button type="button" class="btn btn-success" id="recomBtn">
         추천</button>
         
      <button type="button" class="btn btn-warning" id="reportBtn">
         신고</button>
	
	<table id="listComment">
		<thead>
			<tr>
				<td>작성자</td>
				<td>날짜</td>
			</tr>
		</thead>
				<tbody th:each="comment : ${list}" th:id="${comment.comNo}">
				<tr>
					<td th:text="${comment.userNick}"></td>
					<td th:text="${comment.comWdate}"></td>
				</tr>
				<tr>
					<td colspan="2" class="comContent" th:text="${comment.comContent}"></td>
				</tr>
				 <tr>
                  <td colspan="2">
                     <button class="modifyComReqBtn" type="button">수정</button>
                     <button id="removeBtn">삭제</button>
                  </td>
               </tr>
               </tbody>
	</table>

	<!-- 댓글 달기 -->
<form method="get">
	
	<div id="addComment">
			<div>
				<textarea id="comContent" rows="5" cols="50"
				placeholder="댓글을 입력해주세요 ."></textarea>
			</div>
			<button id="addComBtn">댓글 달기</button>
			
			</div>
	<!-- 댓글 수정 -->
	<div id="modifyComment" style="display: none;">
		<div>
			<input type="hidden" id="comNo" >
			<textarea id="modifyComContent" rows="5" cols="50"
				placeholder="댓글을 입력해주세오 ."></textarea>
		</div>

			<div>
				<button id="cancel">취소</button>
				<button id="modifyComBtn">수정하기</button>
			</div>
	</div>

	</form>
</div>
</section>
</html>