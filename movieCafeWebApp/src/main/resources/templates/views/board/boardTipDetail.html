<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/defaultLayout}">
<head>
<script>
$(document).ready(function(){
	const comNo = $(this).parents('tbody').attr('id');
	$("#addComBtn").click(function(){
			$.ajax({
				url : encodeURI('/createCom'),
				type : 'POST',
				contentType : 'application/json;charset=utf-8',
				data : JSON.stringify({
					"boardNo" : $('#boardNo').val(),
					"userId" : $('#userId').val(),
					"comContent" : $('#comContent').val()
				}),
				success : function(data){
					const comment = data.results;
					$('#ListComment').html("");
					let str = "";
					for(let i = 0 ; i < comment.length ; i++){
						str += '<tr>' + 
			 						'<td>' + comment[i].userNick + '</td>' + 
			 						'<td>' + comment[i].comWdate + '</td>' + 
			 					'</tr>' + 		
			 					'<tr>' + 
			 						'<td colspan="2" class="comContent">' + comment[i].comContent + '</td>' + 
			 					'</tr>' +
			 					'<tr>' +	
			 						'<td colspan="2">' + 
			 							'<button class="modifyFormBtn" type="button">수정</button>&nbsp;' + 		
			 							'<button id="removeBtn">삭제</button>' +
			 						'</td>'	+ 				
			 					'</tr>'
					}
						$('#listComment').html(str);

				},
				error : function(err){
					console.log(err);
				}


			});
	});
	

	$(document).on("click", "#removeBtn", function(){
		const comNo = $(this).parents('tbody').attr('id');
		const boardNo = $('#boardNo').val();
		$.ajax({
			url : '/remove/'+ comNo + "/" + boardNo,
			type : 'post',
			dataType : 'json',
			success : function(data){
					const comment = data.results;
					$('#ListComment').html("");
					let str = "";
					for(let i = 0 ; i < comment.length ; i++){
						str += '<tbody id=' + comment[i].comNo + '>' +
									'<tr>' + 
			 						'<td>' + comment[i].userNick + '</td>' + 
			 						'<td>' + comment[i].comWdate + '</td>' + 
			 					'</tr>' + 		
			 					'<tr>' + 
			 						'<td colspan="2" class="comContent">' + comment[i].comContent + '</td>' + 
			 					'</tr>' +
			 					'<tr>' +	
			 						'<td colspan="2">' + 
			 							'<button class="modifyFormBtn" type="button">수정</button>&nbsp;' + 		
			 							'<button id="removeBtn" type="button">삭제</button>' +	
			 						'</td>'	+ 				
			 					'</tr></tbody>'
					}
						$('#listComment').html(str);

				},
				error : function(err){
					console.log(err);
				}
		});
	});
	
});
</script>

</head>
<section layout:fragment="content">
	<p id="idid" th:text="${board.boardNo}">
	<div class="container">
	
		<table class="table">
			<tr>
				<td colspan="5" th:text="${board.boardTitle}"></td>
			</tr>
			<tr>
				<td th:text="${board.userNick}"></td>
				<td th:text="${board.boardWdate}"></td>
				<td th:text="${board.boardCount}"></td>
				<td th:text="${board.recomCount}"></td>
				<td th:text="${board.commentCount}"></td>
			</tr>
			<tr>
				<td colspan="5" th:text="${board.boardContent}"></td>
			</tr>
		</table>

	<button type="submit" class="btn btn-danger waves-effect waves-light">삭제</button>
		<a class="btn btn-default waves-effect waves-light" th:href="@{/modifyform/{boardNo}(boardNo=${boardNo})}">수정</a>
	</div>
	
	<input id="apiX" type="hidden" th:value="${board.apiX}">
	
	<span th:if="${board.apiX} != null or ${board.apiX} != ','">
	<p>ddddddddddddd</p>
	</span>
		<div id="staticMap" style="width:600px;height:350px;"></div>    

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=9a78a37acbaa267bade844724b94c806"></script>
<script>
// 이미지 지도에서 마커가 표시될 위치입니다 
var markerPosition  = new kakao.maps.LatLng(33.450701, 126.570667); 

// 이미지 지도에 표시할 마커입니다
// 이미지 지도에 표시할 마커는 Object 형태입니다
var marker = {
    position: markerPosition
};

var staticMapContainer  = document.getElementById('staticMap'), // 이미지 지도를 표시할 div  
    staticMapOption = { 
        center: new kakao.maps.LatLng(33.450701, 126.570667), // 이미지 지도의 중심좌표
        level: 3, // 이미지 지도의 확대 레벨
        marker: marker // 이미지 지도에 표시할 마커 
    };    

// 이미지 지도를 생성합니다
var staticMap = new kakao.maps.StaticMap(staticMapContainer, staticMapOption);
</script>
	
	
	
	<table>
		<thead>
			<tr>
				<td>작성자</td>
				<td>날짜</td>
			</tr>
		</thead>
		<div id="listComment">
			<p th:each="comment : ${list}">
				<tbody th:id="${comment.comNo}">
				<tr>
					<td th:text="${comment.userNick}"></td>
					<td th:text="${comment.comWdate}"></td>
				</tr>
				<tr>
					<td colspan="2" class="comContent" th:text="${comment.comContent}"></td>
				</tr>
				 <tr>
                  <td colspan="2">
                     <button class="modifyFormBtn" type="button">수정</button>
                     <button id="removeBtn">삭제</button>
                  </td>
               </tr>
               </tbody>
			</p>
		</div>
	</table>


	<!-- 댓글 달기 -->
<form method="get">
	
	<div id="addComment">
		<input type="hidden" id="boardNo" name="boardNo" th:value="${board.boardNo}">
		<input type="hidden" id="userId" name="userId" th:value="${board.userId}">
			<div>
				<textarea name="comContent" id="comContent" rows="5" cols="50"
				placeholder="댓글을 입력해주세요 ."></textarea>
			</div>
			<button id="addComBtn">댓글 달기</button>
			
			</div>
	<!-- 댓글 수정 -->
	<div id="modifyComment" style="display: none;">
		<div>
			<input type="hidden" id="comNo" >
			<textarea id="modifyComContent" rows="5" cols="50"
				placeholder="댓글을 입력해주세오 ."></textarea>
		</div>

			<div>
				<button id="cancel">취소</button>
				<button id="modifyComBtn">수정하기</button>
			</div>
	</div>
</form>
</section>
</html>