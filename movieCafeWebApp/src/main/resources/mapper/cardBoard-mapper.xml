<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cardBoard">

	<!-- 카드게시판 목록 조회 -->
	<resultMap type="boardVO" id="cardBoardSelectList">
		<result property="boardNo" javaType="int" column="boardNo" jdbcType="INTEGER" />
		<result property="userNick" javaType="string" column="userNick" jdbcType="VARCHAR" />
		<result property="horse" javaType="string" column="horse" jdbcType="VARCHAR" />
		<result property="boardContent" javaType="string" column="boardContent" jdbcType="VARCHAR" />
		<result property="boardTitle" javaType="string" column="boardTitle" jdbcType="VARCHAR" />
		<result property="boardWdate" javaType="string" column="boardWdate" jdbcType="VARCHAR" />
		<result property="commentCount" javaType="int" column="commentCount" jdbcType="INTEGER" />
	</resultMap>
	
	<!-- 게시글 목록조회 -->
	<select id="selectCardBoardList" statementType="STATEMENT" resultMap="cardBoardSelectList">

		SELECT b.boardNo, b.boardTitle,b.boardContent, h.horse, u.userNick, DATE_FORMAT(b.boardWdate, '%Y-%m-%d') as boardWdate, b.boardCount
		FROM board as b left join user_info as u using(userId) left join horse as h using(horseNo)
		where h.cateNo = 2
		ORDER BY b.boardWdate DESC;
		
	</select>
	
	<!-- 게시글 상세조회 -->
	<select id="selectCardBoard" parameterType="int" resultMap="cardBoardSelectList">
	
		SELECT b.boardNo, b.boardTitle,b.boardContent, b.userId,  h.horse, u.userNick, DATE_FORMAT(b.boardWdate, '%Y-%m-%d') as boardWdate, b.boardCount
		FROM board as b left join user_info as u using(userId) left join horse as h using(horseNo)
		where b.boardNo = #{boardNo}

	</select>
	
	
	<insert id="insertCardBoard" parameterType="hashMap" useGeneratedKeys="true" keyProperty="boardNo">
		
		INSERT INTO board (userId, boardTitle, boardContent, horseNo)
		VALUES (#{userId}, #{boardTitle}, #{boardContent}, #{horseNo})
	
	</insert>
	
	<update id="updateBoardCount" parameterType="int">
	
	UPDATE board
	SET boardCount = boardCount + 1
	WHERE boardNo = #{boardNo};
	
	</update>
	
	<!-- 게시글 삭제 -->
	<delete id="deleteCardBoard" parameterType="int">
	
	DELETE FROM board
	WHERE boardNo = ${boardNo}
	
	</delete>
		
	</mapper>
